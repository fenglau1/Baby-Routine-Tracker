<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Baby Routine</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div id="sidebar-backdrop" class="sidebar-backdrop hidden" onclick="app.toggleSidebar()"></div>
        <aside id="sidebar" class="sidebar hidden">
            <div class="sidebar-header">
                <h2>Menu</h2>
                <button class="close-btn" onclick="app.toggleSidebar()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="sidebar-content">
                <nav class="sidebar-nav">
                    <button class="sidebar-btn" onclick="app.openModal('settings-modal'); app.toggleSidebar()">
                        <i class="fa-solid fa-gear"></i> Settings
                    </button>
                    <button class="sidebar-btn" onclick="app.openModal('charts-view'); app.toggleSidebar()">
                        <i class="fa-solid fa-chart-pie"></i> Charts
                    </button>
                    <button class="sidebar-btn" onclick="app.openModal('health-view'); app.toggleSidebar()">
                        <i class="fa-solid fa-heart-pulse"></i> Health
                    </button>
                </nav>
            </div>
        </aside>

        <!-- Header -->
        <header class="glass-header">
            <div class="header-top">
                <button id="menu-btn" class="icon-btn" onclick="app.toggleSidebar()"><i
                        class="fa-solid fa-bars"></i></button>
                <div class="header-title-group">
                    <h1>Baby Routine</h1>
                    <span id="current-baby-name-display"
                        style="font-size: 14px; color: var(--secondary-text); display: block;">My Baby</span>
                </div>
                <button id="add-baby-header-btn" class="icon-btn" onclick="app.openBabySwitcher()"><i
                        class="fa-solid fa-users"></i></button>
            </div>

            <!-- Baby Profile Card -->
            <div id="baby-profile-card" class="baby-card hidden">
                <div class="profile-image-container">
                    <img id="profile-img" src="assets/default-baby.png" alt="Baby"
                        onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2NjYyI+PHBhdGggZD0iTTEyIDEyYzIuMjEgMCA0LTEuNzkgNC00cy0xLjc5LTQtNC00LTQgMS43OS00IDQgMS43OSA0IDQgNHptMCAyYy0yLjY3IDAtOCAxLjM0LTggNHYyaDE2di0yYzAtMi42Ni01LjMzLTQtOC00eiIvPjwvc3ZnPg=='">
                    <label for="photo-upload" class="camera-btn">
                        <i class="fa-solid fa-camera"></i>
                    </label>
                    <input type="file" id="photo-upload" accept="image/*" hidden
                        onchange="app.handlePhotoUpload(this.files[0])">
                </div>
                <h2 id="baby-name">Baby Name</h2>
                <p id="baby-age" class="subtitle">0 months old</p>

                <div class="stats-row">
                    <div class="stat-item">
                        <span class="stat-label">Weight</span>
                        <span id="baby-weight" class="stat-value">-- kg</span>
                    </div>
                    <div class="divider"></div>
                    <div class="stat-item">
                        <span class="stat-label">Height</span>
                        <span id="baby-height" class="stat-value">-- cm</span>
                    </div>
                </div>

                <div class="action-row">
                    <button id="update-stats-btn" class="sm-btn" onclick="app.openModal('edit-profile-modal')">Edit
                        Profile</button>
                    <button id="view-growth-btn" class="sm-btn secondary"
                        onclick="app.openModal('growth-modal')">Growth</button>
                    <button id="view-health-btn" class="sm-btn secondary"
                        onclick="app.openModal('health-view')">Health</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main id="main-content">
            <!-- Quick Actions -->
            <section class="quick-actions">
                <button class="action-card milk" onclick="app.openModal('milk-modal')">
                    <div class="icon-circle"><i class="fa-solid fa-bottle-water"></i></div>
                    <span>Log Milk</span>
                </button>
                <button class="action-card food" onclick="app.openModal('food-modal')">
                    <div class="icon-circle"><i class="fa-solid fa-utensils"></i></div>
                    <span>Log Food</span>
                </button>
                <button class="action-card poop" onclick="app.openModal('poop-modal')">
                    <div class="icon-circle"><i class="fa-solid fa-poo"></i></div>
                    <span>Log Poop</span>
                </button>
            </section>

            <!-- Recent History -->
            <section class="history-section">
                <div class="section-header">
                    <h3>Recent Activity</h3>
                    <button id="view-all-history-btn" class="link-btn"
                        onclick="app.openModal('history-view'); ui.renderFullHistory('milk')">View All</button>
                </div>
                <div id="recent-list" class="record-list">
                    <!-- Records will be injected here -->
                </div>
            </section>
        </main>

        <!-- Modals -->

        <!-- Switch Baby Modal -->
        <div id="switch-baby-modal" class="modal hidden" style="z-index: 1200;">
            <div class="modal-content bottom-sheet">
                <div class="modal-header">
                    <h3>Switch Baby</h3>
                    <button class="close-btn" onclick="app.closeModal('switch-baby-modal')"><i
                            class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="modal-body">
                    <div id="baby-list" class="baby-list-container">
                        <!-- Injected via JS -->
                    </div>
                    <button class="primary-btn" onclick="app.addNewBaby()">
                        <i class="fa-solid fa-plus"></i> Add New Baby
                    </button>
                </div>
            </div>
        </div>

        <!-- Milk Modal -->
        <div id="milk-modal" class="modal hidden">
            <div class="modal-content bottom-sheet">
                <div class="modal-header">
                    <h3>Log Milk</h3>
                    <button class="close-btn" onclick="app.closeModal('milk-modal')"><i
                            class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Time</label>
                        <input type="datetime-local" id="milk-time">
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <div class="segmented-control">
                            <button class="segment active" data-value="Formula"
                                onclick="ui.selectSegment(this, 'milk-type')">Formula</button>
                            <button class="segment" data-value="Breast Milk"
                                onclick="ui.selectSegment(this, 'milk-type')">Breast Milk</button>
                        </div>
                        <input type="hidden" id="milk-type" value="Formula">
                    </div>
                    <div class="form-group">
                        <label>Amount (<span id="unit-vol">ml</span>)</label>
                        <div class="amount-control-container">
                            <div class="amount-input-wrapper">
                                <button class="adjust-btn minus" onclick="ui.adjustAmountDelta(-5)"><i
                                        class="fa-solid fa-minus"></i></button>
                                <input type="number" id="milk-amount" value="100">
                                <button class="adjust-btn plus" onclick="ui.adjustAmountDelta(5)"><i
                                        class="fa-solid fa-plus"></i></button>
                            </div>
                            <div class="quick-add-row">
                                <button onclick="ui.adjustAmount(60)">60</button>
                                <button onclick="ui.adjustAmount(90)">90</button>
                                <button onclick="ui.adjustAmount(120)">120</button>
                                <button onclick="ui.adjustAmount(150)">150</button>
                            </div>
                        </div>
                    </div>
                    <button class="primary-btn" onclick="app.saveMilk()">Save Record</button>
                </div>
            </div>
        </div>

        <!-- Food Modal -->
        <div id="food-modal" class="modal hidden">
            <div class="modal-content bottom-sheet">
                <div class="modal-header">
                    <h3>Log Food</h3>
                    <button class="close-btn" onclick="app.closeModal('food-modal')"><i
                            class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Time</label>
                        <input type="datetime-local" id="food-time">
                    </div>
                    <div class="form-group">
                        <label>Meal Type</label>
                        <div class="meal-type-row">
                            <button class="meal-btn active" data-value="Breakfast" onclick="ui.selectMeal(this)">
                                <span class="emoji">ü•û</span>
                                <span class="label">Breakfast</span>
                            </button>
                            <button class="meal-btn" data-value="Lunch" onclick="ui.selectMeal(this)">
                                <span class="emoji">üç±</span>
                                <span class="label">Lunch</span>
                            </button>
                            <button class="meal-btn" data-value="Dinner" onclick="ui.selectMeal(this)">
                                <span class="emoji">üç≤</span>
                                <span class="label">Dinner</span>
                            </button>
                            <button class="meal-btn" data-value="Snack" onclick="ui.selectMeal(this)">
                                <span class="emoji">üç™</span>
                                <span class="label">Snack</span>
                            </button>
                        </div>
                        <input type="hidden" id="food-meal-type" value="Breakfast">
                    </div>
                    <div class="form-group">
                        <label>Food Item</label>
                        <input type="text" id="food-item" placeholder="e.g. Mashed Potatoes">
                    </div>
                    <div class="form-group">
                        <label>Mood</label>
                        <div class="mood-row">
                            <button class="mood-btn active" data-value="üòä" onclick="ui.selectMood(this)">üòä</button>
                            <button class="mood-btn" data-value="üòê" onclick="ui.selectMood(this)">üòê</button>
                            <button class="mood-btn" data-value="üò´" onclick="ui.selectMood(this)">üò´</button>
                            <button class="mood-btn" data-value="üò≠" onclick="ui.selectMood(this)">üò≠</button>
                            <button class="mood-btn" data-value="üòã" onclick="ui.selectMood(this)">üòã</button>
                        </div>
                        <input type="hidden" id="food-mood" value="üòä">
                    </div>
                    <button class="primary-btn" onclick="app.saveFood()">Save Record</button>
                </div>
            </div>
        </div>

        <!-- Poop Modal -->
        <div id="poop-modal" class="modal hidden">
            <div class="modal-content bottom-sheet">
                <div class="modal-header">
                    <h3>Log Poop</h3>
                    <button class="close-btn" onclick="app.closeModal('poop-modal')"><i
                            class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Time</label>
                        <input type="datetime-local" id="poop-time">
                    </div>
                    <div class="form-group">
                        <label>Color</label>
                        <div class="color-row">
                            <button class="color-btn active" style="background-color: #FFD700;" data-value="Yellow"
                                onclick="ui.selectColor(this)"></button>
                            <button class="color-btn" style="background-color: #8B4513;" data-value="Brown"
                                onclick="ui.selectColor(this)"></button>
                            <button class="color-btn" style="background-color: #008000;" data-value="Green"
                                onclick="ui.selectColor(this)"></button>
                            <button class="color-btn" style="background-color: #000000;" data-value="Black"
                                onclick="ui.selectColor(this)"></button>
                            <button class="color-btn" style="background-color: #FF0000;" data-value="Red"
                                onclick="ui.selectColor(this)"></button>
                        </div>
                        <p id="selected-color-name">Yellow</p>
                        <input type="hidden" id="poop-color" value="Yellow">
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="poop-notes" rows="3"></textarea>
                    </div>
                    <button class="primary-btn" onclick="app.savePoop()">Save Record</button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-content fullscreen">
                <div class="modal-header">
                    <button class="back-btn" onclick="app.closeModal('settings-modal')"><i
                            class="fa-solid fa-chevron-left"></i> Back</button>
                    <h3>Settings</h3>
                    <div style="width: 40px;"></div> <!-- Spacer -->
                </div>
                <div class="modal-body">
                    <!-- Auth Section Moved Here -->
                    <div id="auth-section" class="settings-section">
                        <h4>Account</h4>
                        <div id="user-info" class="user-profile-row hidden">
                            <img id="user-avatar" src="" alt="User">
                            <div class="user-details">
                                <span id="user-name">User</span>
                                <span id="user-email" class="subtitle"></span>
                            </div>
                        </div>
                        <button id="login-btn" class="setting-btn primary" onclick="Auth.login()">
                            <i class="fa-brands fa-google"></i> Sign in with Google
                        </button>
                        <button id="logout-btn" class="setting-btn destructive hidden" onclick="Auth.logout()">
                            <i class="fa-solid fa-sign-out-alt"></i> Sign Out
                        </button>
                    </div>

                    <div class="settings-section">
                        <h4>Appearance</h4>
                        <div class="setting-item">
                            <span>Dark Mode</span>
                            <label class="switch">
                                <input type="checkbox" id="dark-mode-toggle" onchange="app.toggleDarkMode()">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h4>Units</h4>
                        <div class="setting-item">
                            <span>Use Metric System (kg/cm)</span>
                            <label class="switch">
                                <input type="checkbox" id="metric-toggle" checked onchange="app.toggleUnits()">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h4>Data Management</h4>
                        <button class="setting-btn" onclick="app.exportData('json')">
                            <i class="fa-solid fa-file-code"></i> Export Backup (JSON)
                        </button>
                        <button class="setting-btn" onclick="app.exportData('excel')">
                            <i class="fa-solid fa-file-excel"></i> Export to Excel
                        </button>
                        <button class="setting-btn" onclick="app.exportData('pdf')">
                            <i class="fa-solid fa-file-pdf"></i> Export to PDF
                        </button>
                        <button class="setting-btn" onclick="document.getElementById('import-file').click()">
                            <i class="fa-solid fa-file-import"></i> Import Data (JSON)
                        </button>
                        <input type="file" id="import-file" accept=".json" hidden onchange="app.importData(this)">
                        <button class="setting-btn" onclick="app.shareAccess()">
                            <i class="fa-solid fa-share-nodes"></i> Share Access
                        </button>
                        <button class="setting-btn destructive" onclick="app.deleteAllData()">
                            <i class="fa-solid fa-trash"></i> Delete All Data
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- History View (Fullscreen Modal) -->
        <div id="history-view" class="modal hidden">
            <div class="modal-content fullscreen">
                <div class="modal-header">
                    <button class="back-btn" onclick="app.closeModal('history-view')"><i
                            class="fa-solid fa-chevron-left"></i> Back</button>
                    <h3>History</h3>
                    <div style="width: 40px;"></div>
                </div>
                <div class="modal-body">
                    <div class="tabs">
                        <button class="tab active" onclick="ui.switchHistoryTab('milk')">Milk</button>
                        <button class="tab" onclick="ui.switchHistoryTab('food')">Food</button>
                        <button class="tab" onclick="ui.switchHistoryTab('poop')">Poop</button>
                    </div>
                    <div id="history-list" class="record-list">
                        <!-- Full history injected here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts View (Fullscreen Modal) -->
        <div id="charts-view" class="modal hidden">
            <div class="modal-content fullscreen">
                <div class="modal-header">
                    <button class="back-btn" onclick="app.closeModal('charts-view')"><i
                            class="fa-solid fa-chevron-left"></i> Back</button>
                    <h3>Charts & Trends</h3>
                    <div style="width: 40px;"></div>
                </div>
                <div class="modal-body">
                    <div class="chart-card">
                        <h4>Milk Intake (Last 7 Days)</h4>
                        <canvas id="milkChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h4>Meal Frequency</h4>
                        <canvas id="foodChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h4>Poop Colors</h4>
                        <canvas id="poopChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Health View (Fullscreen Modal) -->
        <div id="health-view" class="modal hidden">
            <div class="modal-content fullscreen">
                <div class="modal-header">
                    <button class="back-btn" onclick="app.closeModal('health-view')"><i
                            class="fa-solid fa-chevron-left"></i> Back</button>
                    <h3>Health & Vaccines</h3>
                    <button class="icon-btn" onclick="app.openModal('add-health-modal')"><i
                            class="fa-solid fa-plus"></i></button>
                </div>
                <div class="modal-body">
                    <div class="tabs">
                        <button class="tab active" onclick="ui.switchHealthTab('appointments')">Appointments</button>
                        <button class="tab" onclick="ui.switchHealthTab('vaccines')">Vaccines</button>
                    </div>
                    <div id="health-list" class="record-list">
                        <!-- Injected via JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Health Record Modal -->
        <div id="add-health-modal" class="modal hidden" style="z-index: 1100;">
            <div class="modal-content bottom-sheet">
                <div class="modal-header">
                    <h3>Add Health Record</h3>
                    <button class="close-btn" onclick="app.closeModal('add-health-modal')"><i
                            class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Type</label>
                        <select id="health-type" onchange="ui.toggleHealthInputs()">
                            <option value="appointment">Appointment</option>
                            <option value="vaccine">Vaccine</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Title / Vaccine Name</label>
                        <input type="text" id="health-title" placeholder="e.g. Pediatrician Visit">
                    </div>
                    <div class="form-group">
                        <label>Date & Time</label>
                        <input type="datetime-local" id="health-date">
                    </div>
                    <div class="form-group" id="vaccine-dose-group" class="hidden">
                        <label>Dose Number</label>
                        <input type="number" id="vaccine-dose" value="1">
                    </div>
                    <div class="form-group">
                        <label>Notes / Location</label>
                        <input type="text" id="health-notes">
                    </div>
                    <button class="primary-btn" onclick="app.saveHealthRecord()">Save</button>
                </div>
            </div>
        </div>

        <!-- Growth Modal -->
        <div id="growth-modal" class="modal hidden">
            <div class="modal-content fullscreen">
                <div class="modal-header">
                    <button class="back-btn" onclick="app.closeModal('growth-modal')"><i
                            class="fa-solid fa-chevron-left"></i> Back</button>
                    <h3>Growth Tracker</h3>
                    <button class="icon-btn" onclick="app.openModal('add-growth-modal')"><i
                            class="fa-solid fa-plus"></i></button>
                </div>
                <div class="modal-body">
                    <div class="chart-card">
                        <h4>Weight History</h4>
                        <canvas id="weightChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h4>Height History</h4>
                        <canvas id="heightChart"></canvas>
                    </div>
                    <div class="section-header">
                        <h3>History</h3>
                    </div>
                    <div id="growth-list" class="record-list">
                        <!-- Injected via JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Growth Modal -->
        <div id="add-growth-modal" class="modal hidden" style="z-index: 1100;">
            <div class="modal-content bottom-sheet">
                <div class="modal-header">
                    <h3>Log Measurement</h3>
                    <button class="close-btn" onclick="app.closeModal('add-growth-modal')"><i
                            class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="growth-date">
                    </div>
                    <div class="form-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="growth-weight" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Height (cm)</label>
                        <input type="number" id="growth-height" step="0.1">
                    </div>
                    <button class="primary-btn" onclick="app.saveGrowthRecord()">Save</button>
                </div>
            </div>
        </div>

        <!-- Edit Profile Modal -->
        <div id="edit-profile-modal" class="modal hidden">
            <div class="modal-content bottom-sheet">
                <div class="modal-header">
                    <h3>Edit Profile</h3>
                    <button class="close-btn" onclick="app.closeModal('edit-profile-modal')"><i
                            class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Baby's Name</label>
                        <input type="text" id="edit-name">
                    </div>
                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" id="edit-dob">
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <select id="edit-gender">
                            <option value="Boy">Boy</option>
                            <option value="Girl">Girl</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Current Weight (kg)</label>
                        <input type="number" id="edit-weight" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Current Height (cm)</label>
                        <input type="number" id="edit-height" step="0.1">
                    </div>
                    <button class="primary-btn" onclick="app.saveProfileUpdates()">Save Changes</button>
                    <button class="destructive-btn"
                        style="margin-top: 10px; width: 100%; padding: 12px; border-radius: 12px; border: none; background: #FFEBEE; color: #D32F2F; font-weight: 600;"
                        onclick="app.deleteCurrentBaby()">Delete Profile</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/store.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/app.js"></script>
</body>

</html>